<!DOCTYPE html>
<html lang=zh>
<head>
    <meta charset="utf-8">
    
    <title>分布式文件系统FastDFS部署搭建 | ini&#39;s Blog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="简介  FastDFS是一款类Google FS的开源分布式文件系统，它用纯C语言实现，支持Linux、FreeBSD、AIX等UNIX系统。它只能通过专有API对文件进行存取访问，不支持POSIX接口方式，不能mount使用。准确地讲，Google FS以及FastDFS、mogileFS、HDFS、TFS等类Google FS都不是系统级的分布式文件系统，而是应用级的分布式文件存储服务。 Fa">
<meta property="og:type" content="article">
<meta property="og:title" content="分布式文件系统FastDFS部署搭建">
<meta property="og:url" content="http://inicb.com/archives/b182ce5c.html">
<meta property="og:site_name" content="ini&#39;s Blog">
<meta property="og:description" content="简介  FastDFS是一款类Google FS的开源分布式文件系统，它用纯C语言实现，支持Linux、FreeBSD、AIX等UNIX系统。它只能通过专有API对文件进行存取访问，不支持POSIX接口方式，不能mount使用。准确地讲，Google FS以及FastDFS、mogileFS、HDFS、TFS等类Google FS都不是系统级的分布式文件系统，而是应用级的分布式文件存储服务。 Fa">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http://res.cloudinary.com/ini/image/upload/v1523517272/1111.jpg">
<meta property="og:image" content="http://res.cloudinary.com/ini/image/upload/v1523519894/0_1290769967A4Li.jpg">
<meta property="og:image" content="http://inicb.com/images/fastdfs_file_download.jpg">
<meta property="og:image" content="http://res.cloudinary.com/ini/image/upload/v1523846624/%E9%80%9A%E8%BF%87nginx%E8%AE%BF%E9%97%AEstorage%E6%96%87%E4%BB%B6.jpg">
<meta property="og:updated_time" content="2018-05-04T02:44:05.166Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="分布式文件系统FastDFS部署搭建">
<meta name="twitter:description" content="简介  FastDFS是一款类Google FS的开源分布式文件系统，它用纯C语言实现，支持Linux、FreeBSD、AIX等UNIX系统。它只能通过专有API对文件进行存取访问，不支持POSIX接口方式，不能mount使用。准确地讲，Google FS以及FastDFS、mogileFS、HDFS、TFS等类Google FS都不是系统级的分布式文件系统，而是应用级的分布式文件存储服务。 Fa">
<meta name="twitter:image" content="http://res.cloudinary.com/ini/image/upload/v1523517272/1111.jpg">
    

    
        <link rel="alternate" href="/" title="ini&#39;s Blog" type="application/atom+xml" />
    

    

    <link rel="stylesheet" href="/libs/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="/libs/open-sans/styles.css">
    <link rel="stylesheet" href="/libs/source-code-pro/styles.css">

    <link rel="stylesheet" href="/css/style.css">

    <script src="/libs/jquery/2.1.3/jquery.min.js"></script>
    
    
        <link rel="stylesheet" href="/libs/lightgallery/css/lightgallery.min.css">
    
    
        <link rel="stylesheet" href="/libs/justified-gallery/justifiedGallery.min.css">
    
    
    
    


</head>

<body>
    <div id="container">
        <header id="header">
    <div id="header-main" class="header-inner">
        <div class="outer">
            <a href="/" id="logo">
                <i class="logo"></i>
                <span class="site-title">ini&#39;s Blog</span>
            </a>
            <nav id="main-nav">
                
                    <a class="main-nav-link" href="/.">Home</a>
                
                    <a class="main-nav-link" href="/archives">Archives</a>
                
                    <a class="main-nav-link" href="/categories">Categories</a>
                
                    <a class="main-nav-link" href="/about">About</a>
                
            </nav>
            
                
                <nav id="sub-nav">
                    <div class="profile" id="profile-nav">
                        <a id="profile-anchor" href="javascript:;">
                            <img class="avatar" src="/css/images/avatar.png" />
                            <i class="fa fa-caret-down"></i>
                        </a>
                    </div>
                </nav>
            
            <div id="search-form-wrap">

    <form class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="搜索" />
        <!-- <button type="submit" class="search-form-submit"></button> -->
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="想要查找什么..." />
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: '文章',
            PAGES: '页面',
            CATEGORIES: '分类',
            TAGS: '标签',
            UNTITLED: '(未命名)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
<script src="/js/insight.js"></script>

</div>

        </div>
    </div>
    <div id="main-nav-mobile" class="header-sub header-inner">
        <table class="menu outer">
            <tr>
                
                    <td><a class="main-nav-link" href="/.">Home</a></td>
                
                    <td><a class="main-nav-link" href="/archives">Archives</a></td>
                
                    <td><a class="main-nav-link" href="/categories">Categories</a></td>
                
                    <td><a class="main-nav-link" href="/about">About</a></td>
                
                <td>
                    
    <div class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="搜索" />
    </div>

                </td>
            </tr>
        </table>
    </div>
</header>

        <div class="outer">
            
            
              <script type='text/javascript'>
              $('body').append("<style type='text/css'>@media screen and (min-width: 1200px) { #main {margin: auto; width: 80%; display: block; float:none;}}</style>");
              </script>
              <script type='text/javascript'>
              document.querySelector('style').textContent += "@media screen and (max-width: 1199px) and (min-width: 800px) { #main {margin: auto; width: 70%; display: block; float:none;}}"
              </script>
           
            <section id="main"><article id="post-分布式文件系统FastDFS部署使用" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 class="article-title" itemprop="name">
            分布式文件系统FastDFS部署搭建
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/archives/b182ce5c.html">
            <time datetime="2018-04-11T08:27:20.000Z" itemprop="datePublished">2018-04-11</time>
        </a>
    </div>


                        
    <div class="article-category">
    	<i class="fa fa-folder"></i>
        <a class="article-category-link" href="/categories/技术开发/">技术开发</a><i class="fa fa-angle-right"></i><a class="article-category-link" href="/categories/技术开发/分布式/">分布式</a>
    </div>

                        
                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
                <div id="toc" class="toc-article">
                <strong class="toc-title">文章目录</strong>
                    <ol class="toc"><li class="toc-item toc-level-5"><a class="toc-link" href="#简介"><span class="toc-number">1.</span> <span class="toc-text">简介</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#FastDFS的架构"><span class="toc-number">2.</span> <span class="toc-text">FastDFS的架构</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#文件上传和下载的交互过程"><span class="toc-number">3.</span> <span class="toc-text">文件上传和下载的交互过程</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#搭建Fastdfs环境"><span class="toc-number">4.</span> <span class="toc-text">搭建Fastdfs环境</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#安装libfastcommon"><span class="toc-number">4.1.</span> <span class="toc-text">安装libfastcommon</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#安装Fastdfs"><span class="toc-number">4.2.</span> <span class="toc-text">安装Fastdfs</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#修改配置文件"><span class="toc-number">4.3.</span> <span class="toc-text">修改配置文件</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#启动Tracker和Storage"><span class="toc-number">4.4.</span> <span class="toc-text">启动Tracker和Storage</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#上传、删除测试"><span class="toc-number">4.5.</span> <span class="toc-text">上传、删除测试</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#在121上部署-Storage"><span class="toc-number">4.6.</span> <span class="toc-text">在121上部署 Storage</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#部署Nginx-fastDFS"><span class="toc-number">5.</span> <span class="toc-text">部署Nginx+fastDFS</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#下载fastdfs-nginx-module"><span class="toc-number">5.1.</span> <span class="toc-text">下载fastdfs-nginx-module</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#安装和编译Nginx-并添加fastDFS模块"><span class="toc-number">5.2.</span> <span class="toc-text">安装和编译Nginx 并添加fastDFS模块</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#在121上配置nginx"><span class="toc-number">5.3.</span> <span class="toc-text">在121上配置nginx</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#120-上配置nginx"><span class="toc-number">5.4.</span> <span class="toc-text">120 上配置nginx</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#启动Nginx"><span class="toc-number">5.5.</span> <span class="toc-text">启动Nginx</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#测试"><span class="toc-number">5.6.</span> <span class="toc-text">测试</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#配置第二个group"><span class="toc-number">6.</span> <span class="toc-text">配置第二个group</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#配置Storage"><span class="toc-number">6.1.</span> <span class="toc-text">配置Storage</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#配置Nginx"><span class="toc-number">6.2.</span> <span class="toc-text">配置Nginx</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#配置访问120上的Nginx"><span class="toc-number">6.3.</span> <span class="toc-text">配置访问120上的Nginx</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#后记"><span class="toc-number">7.</span> <span class="toc-text">后记</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#常见问题"><span class="toc-number">8.</span> <span class="toc-text">常见问题</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#Storage-WAIT-SYNC-问题"><span class="toc-number">8.1.</span> <span class="toc-text">Storage WAIT_SYNC 问题</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#参考资料"><span class="toc-number">9.</span> <span class="toc-text">参考资料</span></a></li></ol>
                </div>
            
            <h5 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h5><p>  FastDFS是一款类Google FS的开源分布式文件系统，它用纯C语言实现，支持Linux、FreeBSD、AIX等UNIX系统。它只能通过专有API对文件进行存取访问，不支持POSIX接口方式，不能mount使用。准确地讲，Google FS以及FastDFS、mogileFS、HDFS、TFS等类Google FS都不是系统级的分布式文件系统，而是应用级的分布式文件存储服务。</p>
<h5 id="FastDFS的架构"><a href="#FastDFS的架构" class="headerlink" title="FastDFS的架构"></a>FastDFS的架构</h5><p>  下图显示的是FastDFS的系统架构。<br><img src="http://res.cloudinary.com/ini/image/upload/v1523517272/1111.jpg" alt=""></p>
<center>图1 FastDFS的系统架构</center>

<a id="more"></a>
<p>从图1可以看出，Tracker server之间相互独立，不存在直接联系。客户端和Storage server <font color="red">主动</font> 连接Tracker server。包括磁盘剩余空间、文件同步状况、文件上传下载次数等统计信息。Storage server会连接集群中所有的Tracker server，向他们报告自己的状态。Storage server启动一个单独的线程来完成对一台Tracker server的连接和定时报告。需要说明的是，一个组包含的Storage server不是通过配置文件设定的，而是通过Tracker server获取到的。<br>不同组的Storage server之间不会相互通信，同组内的Storage server之间会相互连接进行文件同步。</p>
<p>Storage server采用binlog文件记录文件上传、删除等更新操作。binlog中只记录文件名，不记录文件内容。</p>
<p>文件同步只在同组内的Storage server之间进行，采用push方式，即源头服务器同步给目标服务器。只有源头数据才需要同步，备份数据并不需要再次同步，否则就构成环路了。有个例外，就是新增加一台Storage server时，由已有的一台Storage server将已有的所有数据（包括源头数据和备份数据）同步给该新增服务器。</p>
<p>Storage server中由专门的线程根据binlog进行文件同步。为了最大程度地避免相互影响以及出于系统简洁性考虑，Storage server对组内除自己以外的每台服务器都会启动一个线程来进行文件同步。</p>
<p>文件同步采用增量同步方式，系统记录已同步的位置（binlog文件偏移量）到标识文件中。标识文件名格式：{dest storage IP}_{port}.mark，例如：192.168.1.14_23000.mark。</p>
<h5 id="文件上传和下载的交互过程"><a href="#文件上传和下载的交互过程" class="headerlink" title="文件上传和下载的交互过程"></a>文件上传和下载的交互过程</h5><p>接下来我们一起看一下文件上传和下载的交互过程。文件上传和下载流程分别如图2、图3所示。文件上传流程的步骤如下：</p>
<center><br><img src="http://res.cloudinary.com/ini/image/upload/v1523519894/0_1290769967A4Li.jpg" alt=""><br></center><br><center>使用fastdfs上传文件</center>

<ol>
<li><p>Client询问Tracker server上传到的Storage server；</p>
</li>
<li><p>Tracker server返回一台可用的Storage server，返回的数据为该Storage server的IP地址和端口；</p>
</li>
<li><p>Client直接和该Storage server建立连接，进行文件上传，Storage server返回新生成的文件ID，文件上传结束。</p>
</li>
</ol>
<p><center><br><img src="/images/fastdfs_file_download.jpg" alt=""><br></center></p>
<p><center>使用Fastdfs下载文件</center></p>
<ol>
<li><p>Client询问Tracker server可以下载指定文件的Storage server，参数为文件ID（包含组名和文件名）；</p>
</li>
<li><p>Tracker server返回一台可用的Storage server；</p>
</li>
<li><p>Client直接和该Storage server建立连接，完成文件下载。</p>
</li>
</ol>
<h5 id="搭建Fastdfs环境"><a href="#搭建Fastdfs环境" class="headerlink" title="搭建Fastdfs环境"></a>搭建Fastdfs环境</h5><p>这里默认关闭了防火墙，并且开启了tracker和storage所需要的端口。tracker默认端口为22122，Storage默认端口为23000</p>
<p>这里我用了两台机器进行搭建192.168.1.120和192.168.1.121，用与搭建1个tracker和2个storage。其中tracker在120上，Storage搭建在120和121上，并且为同一分组。</p>
<ol>
<li>192.168.1.120 nginx + Tracker + Storage1</li>
<li>192.168.1.121 Nginx + Storage2</li>
</ol>
<p>下面开始搭建：</p>
<p>首先在120机器上进行安装（Tracker Server）</p>
<h6 id="安装libfastcommon"><a href="#安装libfastcommon" class="headerlink" title="安装libfastcommon"></a>安装libfastcommon</h6><p>git下载地址：<a href="https://github.com/happyfish100/fastdfs.git" target="_blank" rel="noopener">https://github.com/happyfish100/fastdfs.git</a><br>解压缩到/data/libfastcommon-master，进入libfastcommon-master，执行<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">./make.sh</span><br><span class="line">./make.sh install</span><br></pre></td></tr></table></figure></p>
<p>确认make没有错误后，执行安装，64位系统默认会复制到/usr/lib64下。<br>这时候检查/usr/lib/libfastcommon.so是否存在，如果不存在需要设置环境变量或者创建软链接<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ln -s /usr/lib64/libfastcommon.so /usr/lib/libfastcommon.so</span><br></pre></td></tr></table></figure></p>
<h6 id="安装Fastdfs"><a href="#安装Fastdfs" class="headerlink" title="安装Fastdfs"></a>安装Fastdfs</h6><p>下载 FastDFS 源程序，git下载地址：<a href="https://github.com/happyfish100/fastdfs.git" target="_blank" rel="noopener">https://github.com/happyfish100/fastdfs.git</a><br>下载之后解压缩到/data/fastdfs-master，然后进入此目录，执行<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">./make.sh</span><br><span class="line"></span><br><span class="line">./make.sh install</span><br></pre></td></tr></table></figure></p>
<p>确认make没有错误后，执行安装，默认会安装到/usr/bin中，并在/etc/fdfs中添加三个配置文件。</p>
<h6 id="修改配置文件"><a href="#修改配置文件" class="headerlink" title="修改配置文件"></a>修改配置文件</h6><p>默认的配置文件安装到/etc/fdfs目录中，如下：</p>
<ol>
<li>storage.conf.sample  Storage的配置文件样例</li>
<li>tracker.conf.sample   Tracker的配置文件样例</li>
<li>client.conf.sample    Fastdfs客户端的配置文件样例。</li>
</ol>
<ul>
<li>tracker.conf修改<br>首先重命名tracker.conf.sample为tracker.conf，修改其中如下：<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">base_path=/data/fastdfs/tracker #用于存放日志。</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>注意：确保/data/fastdfs/tracker目录存在</p>
<ul>
<li>storage.conf修改<br>首先重命名storage.conf.sample为storage.conf，修改其中如下：<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">base_path=/data/fastdfs/storage #用于存放日志。</span><br><span class="line">store_path0=/data/fastdfs/storage #存放数据，若不设置默认为前面那个。</span><br><span class="line">tracker_server=192.168.1.120:22122 #指定tracker服务器地址。不能是127.0.0.1</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>注意：确保/data/fastdfs/storage目录存在</p>
<ul>
<li>client.conf修改<br>首先重命名storage.conf.sample为storage.conf，修改其中如下：<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">base_path=/data/fastdfs/client #用于存放日志。</span><br><span class="line">tracker_server=192.168.1.120:22122 #指定tracker服务器地址。</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h6 id="启动Tracker和Storage"><a href="#启动Tracker和Storage" class="headerlink" title="启动Tracker和Storage"></a>启动Tracker和Storage</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/usr/bin/fdfs_trackerd /etc/fdfs/tracker.conf</span><br><span class="line">/usr/bin/fdfs_storaged /etc/fdfs/storage.conf</span><br></pre></td></tr></table></figure>
<p>检查进程,确认是否启动<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># ps -ef | grep fdfs</span><br><span class="line">root      5980     1  0 19:24 ?        00:00:00 /usr/bin/fdfs_trackerd /etc/fdfs/tracker.conf</span><br><span class="line">root      6011     1 12 19:24 ?        00:00:00 /usr/bin/fdfs_storaged /etc/fdfs/storage.conf</span><br><span class="line">root      6021  5958  0 19:24 pts/0    00:00:00 grep --color=auto fdfs</span><br></pre></td></tr></table></figure></p>
<p>表示启动ok了，若有错误，可以在/usr/fastdfs/tracker/logs 目录下检查日志。</p>
<h6 id="上传、删除测试"><a href="#上传、删除测试" class="headerlink" title="上传、删除测试"></a>上传、删除测试</h6><ul>
<li>上传文件<br>使用自带的fdfs_test来测试，使用格式如下：<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># fdfs_test</span><br><span class="line"></span><br><span class="line">This is FastDFS client test program v5.12</span><br><span class="line"></span><br><span class="line">Copyright (C) 2008, Happy Fish / YuQing</span><br><span class="line"></span><br><span class="line">FastDFS may be copied only under the terms of the GNU General</span><br><span class="line">Public License V3, which may be found in the FastDFS source kit.</span><br><span class="line">Please visit the FastDFS Home Page http://www.csource.org/</span><br><span class="line">for more detail.</span><br><span class="line"></span><br><span class="line">Usage: fdfs_test &lt;config_file&gt; &lt;operation&gt;</span><br><span class="line">	operation: upload, download, getmeta, setmeta, delete and query_servers</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>使用以下命令上传文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fdfs_test /etc/fdfs/client.conf upload /data/test.jpeg</span><br></pre></td></tr></table></figure></p>
<p>输入结果如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">This is FastDFS client test program v5.12</span><br><span class="line"></span><br><span class="line">Copyright (C) 2008, Happy Fish / YuQing</span><br><span class="line"></span><br><span class="line">FastDFS may be copied only under the terms of the GNU General</span><br><span class="line">Public License V3, which may be found in the FastDFS source kit.</span><br><span class="line">Please visit the FastDFS Home Page http://www.csource.org/</span><br><span class="line">for more detail.</span><br><span class="line"></span><br><span class="line">[2018-04-13 22:07:03] DEBUG - base_path=/data/fastdfs/client, connect_timeout=30, network_timeout=60, tracker_server_count=1, anti_steal_token=0, anti_steal_secret_key length=0, use_connection_pool=0, g_connection_pool_max_idle_time=3600s, use_storage_id=0, storage server id count: 0</span><br><span class="line"></span><br><span class="line">tracker_query_storage_store_list_without_group:</span><br><span class="line">	server 1. group_name=, ip_addr=192.168.1.120, port=23000</span><br><span class="line"></span><br><span class="line">group_name=group1, ip_addr=192.168.1.120, port=23000</span><br><span class="line">storage_upload_by_filename</span><br><span class="line">group_name=group1, remote_filename=M00/00/00/wKgBeFrQuYeAATHaAAKE3TYxPy085.jpeg</span><br><span class="line">source ip address: 192.168.1.120</span><br><span class="line">file timestamp=2018-04-13 22:07:03</span><br><span class="line">file size=165085</span><br><span class="line">file crc32=909197101</span><br><span class="line">example file url: http://192.168.1.120/group1/M00/00/00/wKgBeFrQuYeAATHaAAKE3TYxPy085.jpeg</span><br><span class="line">storage_upload_slave_by_filename</span><br><span class="line">group_name=group1, remote_filename=M00/00/00/wKgBeFrQuYeAATHaAAKE3TYxPy085_big.jpeg</span><br><span class="line">source ip address: 192.168.1.120</span><br><span class="line">file timestamp=2018-04-13 22:07:03</span><br><span class="line">file size=165085</span><br><span class="line">file crc32=909197101</span><br><span class="line">example file url: http://192.168.1.120/group1/M00/00/00/wKgBeFrQuYeAATHaAAKE3TYxPy085_big.jpeg</span><br></pre></td></tr></table></figure></p>
<p>可以看到，上传ok了，这里会生成两个文件，这是fastdfs的主/从文件特性，以后再介绍。example file url是不能在浏览器中直接打开的，除非配合nginx使用，以后再介绍。</p>
<ul>
<li>删除文件<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fdfs_delete_file /etc/fdfs/client.conf group1/M00/00/00/wKgBeFrQuYeAATHaAAKE3TYxPy085.jpeg</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>至此，我们就已经配置好了120上的 Tracker 和 Storage。</p>
<h6 id="在121上部署-Storage"><a href="#在121上部署-Storage" class="headerlink" title="在121上部署 Storage"></a>在121上部署 Storage</h6><p>同样的在121服务器上，按照以上步骤进行fastdfs安装，配置，启动。在121上只需要配置和启动 Storage 就行。其中121上的 Storage 配置文件 <font color="red"> /etc/fastdfs/storage.conf </font>中的 group_name设为group1，于120上的 Storage 相同。</p>
<p>在启动之后使用一下命令查看两个 Storage 是否启动成功，显示以下表示同一个group的两个 Storage 都已经启动成功，并且注册到了 Tracker 服务器上。。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># fdfs_monitor /etc/fdfs/client.conf | grep ip_addr</span><br><span class="line"></span><br><span class="line">  ip_addr = 192.168.1.120  ACTIVE</span><br><span class="line">  ip_addr = 192.168.1.121  ACTIVE</span><br></pre></td></tr></table></figure></p>
<p>这时候我们再使用以下命令上传一个文件，会发现有两个 Storage 可用。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fdfs_test /etc/fdfs/client.conf upload /data/1.png</span><br></pre></td></tr></table></figure></p>
<p>显示如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">This is FastDFS client test program v5.12</span><br><span class="line"></span><br><span class="line">Copyright (C) 2008, Happy Fish / YuQing</span><br><span class="line"></span><br><span class="line">FastDFS may be copied only under the terms of the GNU General</span><br><span class="line">Public License V3, which may be found in the FastDFS source kit.</span><br><span class="line">Please visit the FastDFS Home Page http://www.csource.org/</span><br><span class="line">for more detail.</span><br><span class="line"></span><br><span class="line">[2018-04-16 17:04:59] DEBUG - base_path=/data/fastdfs/client, connect_timeout=30, network_timeout=60, tracker_server_count=1, anti_steal_token=0, anti_steal_secret_key length=0, use_connection_pool=0, g_connection_pool_max_idle_time=3600s, use_storage_id=0, storage server id count: 0</span><br><span class="line"></span><br><span class="line">tracker_query_storage_store_list_without_group:</span><br><span class="line">	&lt;font color=&apos;red&apos;&gt;server 1. group_name=, ip_addr=192.168.1.120, port=23000&lt;/font&gt;</span><br><span class="line">	server 2. group_name=, ip_addr=192.168.1.121, port=23000</span><br><span class="line"></span><br><span class="line">group_name=group1, ip_addr=192.168.1.121, port=23000</span><br><span class="line">storage_upload_by_filename</span><br><span class="line">group_name=group1, remote_filename=M00/00/00/wKgBeVrUZzqAcggmAAAIRpdONjU014.png</span><br><span class="line">source ip address: 192.168.1.121</span><br><span class="line">file timestamp=2018-04-16 17:04:58</span><br><span class="line">file size=2118</span><br><span class="line">file crc32=2538485301</span><br><span class="line">example file url: http://192.168.1.121/group1/M00/00/00/wKgBeVrUZzqAcggmAAAIRpdONjU014.png</span><br><span class="line">storage_upload_slave_by_filename</span><br><span class="line">group_name=group1, remote_filename=M00/00/00/wKgBeVrUZzqAcggmAAAIRpdONjU014_big.png</span><br><span class="line">source ip address: 192.168.1.121</span><br><span class="line">file timestamp=2018-04-16 17:04:58</span><br><span class="line">file size=2118</span><br><span class="line">file crc32=2538485301</span><br><span class="line">example file url: http://192.168.1.121/group1/M00/00/00/wKgBeVrUZzqAcggmAAAIRpdONjU014_big.png</span><br></pre></td></tr></table></figure></p>
<p>默认fastdfs会选择一台机器作为存储，文件上传完毕后，会自动同步到别的 Storage.</p>
<p>到此位置，我们部署了两台位于同一 group的 Storage。</p>
<h5 id="部署Nginx-fastDFS"><a href="#部署Nginx-fastDFS" class="headerlink" title="部署Nginx+fastDFS"></a>部署Nginx+fastDFS</h5><p>上面我们已经完成了 Tracker 和 Storage 的部署和配置，但是上传到 Storage 的文件还没办法访问，并且文件在同步的过程中，也会出现未同步完成的情况，所以需要配置Nginx。</p>
<p>Nginx安装fastDFS模块，主要是安装在fastDFS，storage存储服务器上，而不是tracker和client上。 这里主要是安装到120，121上。</p>
<p>目的实际是为了，当输入类似<br><a href="http://192.168.1.120/group1/M00/00/00/wKgCbFem0l2ALSbFAAEYXfRAMkc536.png" target="_blank" rel="noopener">http://192.168.1.120/group1/M00/00/00/wKgCbFem0l2ALSbFAAEYXfRAMkc536.png</a><br>URL地址，其中192.168.1.120 是一个storage服务器。<br>能够通过nginx的web服务功能，直接返回图片。</p>
<p>注意：全部安装条件在确保之前的fastDFS 的Tracker和storage和client可以正常使用</p>
<h6 id="下载fastdfs-nginx-module"><a href="#下载fastdfs-nginx-module" class="headerlink" title="下载fastdfs-nginx-module"></a>下载fastdfs-nginx-module</h6><p>下载地址：<a href="https://github.com/happyfish100/fastdfs-nginx-module" target="_blank" rel="noopener">https://github.com/happyfish100/fastdfs-nginx-module</a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">unzip fastdfs-nginx-module-master.zip</span><br><span class="line">cd fastdfs-nginx-module-master</span><br></pre></td></tr></table></figure></p>
<p>会发现里面有个INSTALL 和 src目录。这个不需要make而是需要重新编译一下storage的Nginx模块</p>
<h6 id="安装和编译Nginx-并添加fastDFS模块"><a href="#安装和编译Nginx-并添加fastDFS模块" class="headerlink" title="安装和编译Nginx 并添加fastDFS模块"></a>安装和编译Nginx 并添加fastDFS模块</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cd nginx-1.10.1/</span><br><span class="line">./configure --prefix=/usr/local/nginx --add-module=/data/fastdfs-nginx-module-master/src/</span><br><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>
<p>其中fastdfs-nginx-module-master是刚才解压的fastdfs模块的绝对路径，就是在编译nginx时候，连同这个模块一起编译。<br>如果在编译安装的时候报一下错误，说明需要安装相应的library<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">./configure: error: the HTTP rewrite module requires the PCRE library.</span><br><span class="line">You can either disable the module by using --without-http_rewrite_module</span><br><span class="line">option, or install the PCRE library into the system, or build the PCRE library</span><br><span class="line">statically from the source with nginx by using --with-pcre=&lt;path&gt; option.</span><br></pre></td></tr></table></figure></p>
<p>执行以下命令进行安装：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install pcre-devel openssl openssl-devel</span><br></pre></td></tr></table></figure></p>
<p>然后重新编译安装。</p>
<ul>
<li>fastdfs-nginx-module 配置文件<br>将fastdfs-nginx-module/src/mod_fastdfs.conf 拷贝到/etc/fdfs/下<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp /data/fastdfs-nginx-module-master/src/mod_fastdfs.conf /etc/fdfs/</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>修改mod_fastdfs.conf，为如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"># 保存日志目录,跟storage.conf一致即可</span><br><span class="line">base_path=/data/fastdfs/storage/</span><br><span class="line">tracker_server=192.168.1.120:22122 #tracker服务器的IP地址以及端口号,确保跟storage.conf一致即可</span><br><span class="line">storage_server_port=23000 #storage服务器的端口号，确保跟storage.conf一致即可</span><br><span class="line">group_name=group1 #当前服务器的group名，确保跟storage.conf一致即可</span><br><span class="line">url_have_group_name = true #文件url中是否有group名，这个最好设置为true，这样方便nginx服务器解析</span><br><span class="line">store_path_count=1 #存储路径个数，需要和store_path个数匹配</span><br><span class="line">store_path0=/usr/fastdfs/fastdfs0 #存储路径,跟storage.conf一致即可</span><br><span class="line"></span><br><span class="line">group_count = 1 #设置组的个数</span><br><span class="line"></span><br><span class="line">[group1]</span><br><span class="line">group_name=group1</span><br><span class="line">storage_server_port=23000</span><br><span class="line">store_path_count=1</span><br><span class="line">store_path0=/usr/fastdfs/fastdfs0</span><br><span class="line"></span><br><span class="line">#如果group_count =2 ，那就再配置一个</span><br></pre></td></tr></table></figure></p>
<h6 id="在121上配置nginx"><a href="#在121上配置nginx" class="headerlink" title="在121上配置nginx"></a>在121上配置nginx</h6><p>这里把120作为负载均衡点，所有的文件访问都是访问120上，然后通过nginx 转发。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /usr/local/nginx/conf/nginx.conf</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">#user  nobody;</span><br><span class="line">worker_processes  1;</span><br><span class="line"></span><br><span class="line">#error_log  logs/error.log;</span><br><span class="line">#error_log  logs/error.log  notice;</span><br><span class="line">#error_log  logs/error.log  info;</span><br><span class="line"></span><br><span class="line">#pid        logs/nginx.pid;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">events &#123;</span><br><span class="line">    worker_connections  1024;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line">    include       mime.types;</span><br><span class="line">    default_type  application/octet-stream;</span><br><span class="line"></span><br><span class="line">    #log_format  main  &apos;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &apos;</span><br><span class="line">    #                  &apos;$status $body_bytes_sent &quot;$http_referer&quot; &apos;</span><br><span class="line">    #                  &apos;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&apos;;</span><br><span class="line"></span><br><span class="line">    #access_log  logs/access.log  main;</span><br><span class="line"></span><br><span class="line">    sendfile        on;</span><br><span class="line">    #tcp_nopush     on;</span><br><span class="line"></span><br><span class="line">    #keepalive_timeout  0;</span><br><span class="line">    keepalive_timeout  65;</span><br><span class="line"></span><br><span class="line">    #gzip  on;</span><br><span class="line"></span><br><span class="line">    server &#123;</span><br><span class="line">        listen       80;</span><br><span class="line">        server_name  localhost;</span><br><span class="line"></span><br><span class="line">        #charset koi8-r;</span><br><span class="line"></span><br><span class="line">        #access_log  logs/host.access.log  main;</span><br><span class="line"></span><br><span class="line">	location ~ /group1/M00 &#123;</span><br><span class="line">            root /data/fastdfs/storage/data;</span><br><span class="line">            ngx_fastdfs_module;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        location / &#123;</span><br><span class="line">            root   html;</span><br><span class="line">            index  index.html index.htm;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        #error_page  404              /404.html;</span><br><span class="line"></span><br><span class="line">        # redirect server error pages to the static page /50x.html</span><br><span class="line">        #</span><br><span class="line">        error_page   500 502 503 504  /50x.html;</span><br><span class="line">        location = /50x.html &#123;</span><br><span class="line">            root   html;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="120-上配置nginx"><a href="#120-上配置nginx" class="headerlink" title="120 上配置nginx"></a>120 上配置nginx</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /usr/local/nginx/conf/nginx.conf</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">#user  nobody;</span><br><span class="line">worker_processes  1;</span><br><span class="line"></span><br><span class="line">#error_log  logs/error.log;</span><br><span class="line">#error_log  logs/error.log  notice;</span><br><span class="line">#error_log  logs/error.log  info;</span><br><span class="line"></span><br><span class="line">#pid        logs/nginx.pid;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">events &#123;</span><br><span class="line">    worker_connections  1024;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line">    include       mime.types;</span><br><span class="line">    default_type  application/octet-stream;</span><br><span class="line"></span><br><span class="line">    #log_format  main  &apos;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &apos;</span><br><span class="line">    #                  &apos;$status $body_bytes_sent &quot;$http_referer&quot; &apos;</span><br><span class="line">    #                  &apos;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&apos;;</span><br><span class="line"></span><br><span class="line">    #access_log  logs/access.log  main;</span><br><span class="line"></span><br><span class="line">    sendfile        on;</span><br><span class="line">    #tcp_nopush     on;</span><br><span class="line"></span><br><span class="line">    #keepalive_timeout  0;</span><br><span class="line">    keepalive_timeout  65;</span><br><span class="line"></span><br><span class="line">    #gzip  on;</span><br><span class="line"></span><br><span class="line">     upstream fdfs_group1 &#123;</span><br><span class="line">                server 192.168.1.120:8080 weight=1 max_fails=2 fail_timeout=30s;</span><br><span class="line">                #server 192.168.1.121 weight=1 max_fails=2 fail_timeout=30s;</span><br><span class="line">        &#125;</span><br><span class="line">     server &#123;</span><br><span class="line">                listen       80;</span><br><span class="line">                server_name  localhost;</span><br><span class="line">                location /group1/M00 &#123;</span><br><span class="line">                        proxy_next_upstream http_502 http_504 error timeout invalid_header;</span><br><span class="line">                        proxy_pass http://fdfs_group1;</span><br><span class="line">                        expires 30d;</span><br><span class="line">                &#125;</span><br><span class="line">                #其他配置</span><br><span class="line">                 location / &#123;</span><br><span class="line">            		root   html;</span><br><span class="line">            		index  index.html index.htm;</span><br><span class="line">        	&#125;</span><br><span class="line">       &#125;</span><br><span class="line">    server &#123;</span><br><span class="line">        listen       8080;</span><br><span class="line">        server_name  localhost;</span><br><span class="line"></span><br><span class="line">        #charset koi8-r;</span><br><span class="line"></span><br><span class="line">        #access_log  logs/host.access.log  main;</span><br><span class="line"></span><br><span class="line">	location /group1/M00&#123;</span><br><span class="line">	    root /data/fastdfs/storage/data;</span><br><span class="line">	    ngx_fastdfs_module;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">        #error_page  404              /404.html;</span><br><span class="line"></span><br><span class="line">        # redirect server error pages to the static page /50x.html</span><br><span class="line">        #</span><br><span class="line">        error_page   500 502 503 504  /50x.html;</span><br><span class="line">        location = /50x.html &#123;</span><br><span class="line">            root   html;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="启动Nginx"><a href="#启动Nginx" class="headerlink" title="启动Nginx"></a>启动Nginx</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># /usr/local/nginx/bin/nginx</span><br></pre></td></tr></table></figure>
<p>观察/usr/local/nginx/logs/errors.log 是否有ERROR存在,如果有类似如下错误:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ERROR - file: ini_file_reader.c, line: 315, include file &quot;http.conf&quot; not exists, line: &quot;#include http.conf&quot;</span><br><span class="line"></span><br><span class="line">ERROR - file: /root/Open_Package/fastdfs-nginx-module/src/common.c, line: 155, load conf file &quot;/etc/fdfs/mod_fastdfs.conf&quot; fail, ret code: 2</span><br><span class="line">2016/08/06 23:51:13 [alert] 12734#0: worker process 12735 exited with fatal code 2 and cannot be respawned</span><br></pre></td></tr></table></figure></p>
<p>类似这种错误会导致nginx-worker启动失败，致使nginx无法提供web服务。<br>表示/etc/fdfs/下缺少http.conf 和mime.types文件<br>从fastdfs-master/conf/http.conf 拷贝到/etc/fdfs/下 从nginx-1.12.2/conf/mime.types 拷贝到/etc/fdfs/下。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cp /data/fastdfs-master/conf/http.conf /etc/fdfs/</span><br><span class="line">cp /data/nginx-1.12.2/conf/mime.types /etc/fdfs/</span><br></pre></td></tr></table></figure></p>
<h6 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h6><p>最后通过上传文件完成测试，如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fdfs_test /etc/fdfs/client.conf upload /data/test.jpeg</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">This is FastDFS client test program v5.12</span><br><span class="line"></span><br><span class="line">Copyright (C) 2008, Happy Fish / YuQing</span><br><span class="line"></span><br><span class="line">FastDFS may be copied only under the terms of the GNU General</span><br><span class="line">Public License V3, which may be found in the FastDFS source kit.</span><br><span class="line">Please visit the FastDFS Home Page http://www.csource.org/</span><br><span class="line">for more detail.</span><br><span class="line"></span><br><span class="line">[2018-04-16 18:30:45] DEBUG - base_path=/data/fastdfs/client, connect_timeout=30, network_timeout=60, tracker_server_count=1, anti_steal_token=0, anti_steal_secret_key length=0, use_connection_pool=0, g_connection_pool_max_idle_time=3600s, use_storage_id=0, storage server id count: 0</span><br><span class="line"></span><br><span class="line">tracker_query_storage_store_list_without_group:</span><br><span class="line">	server 1. group_name=, ip_addr=192.168.1.120, port=23000</span><br><span class="line">	server 2. group_name=, ip_addr=192.168.1.121, port=23000</span><br><span class="line"></span><br><span class="line">group_name=group1, ip_addr=192.168.1.120, port=23000</span><br><span class="line">storage_upload_by_filename</span><br><span class="line">group_name=group1, remote_filename=M00/00/00/wKgBeFrUe1WAc3GuAAEyOqIsuc852.jpeg</span><br><span class="line">source ip address: 192.168.1.120</span><br><span class="line">file timestamp=2018-04-16 18:30:45</span><br><span class="line">file size=78394</span><br><span class="line">file crc32=2720840143</span><br><span class="line">example file url: http://192.168.1.120/group1/M00/00/00/wKgBeFrUe1WAc3GuAAEyOqIsuc852.jpeg</span><br><span class="line">storage_upload_slave_by_filename</span><br><span class="line">group_name=group1, remote_filename=M00/00/00/wKgBeFrUe1WAc3GuAAEyOqIsuc852_big.jpeg</span><br><span class="line">source ip address: 192.168.1.120</span><br><span class="line">file timestamp=2018-04-16 18:30:45</span><br><span class="line">file size=78394</span><br><span class="line">file crc32=2720840143</span><br><span class="line">example file url: http://192.168.1.120/group1/M00/00/00/wKgBeFrUe1WAc3GuAAEyOqIsuc852_big.jpeg</span><br></pre></td></tr></table></figure>
<p>表示文件上传成功，通过浏览器访问<br><a href="http://192.168.1.120/group1/M00/00/00/wKgBeFrUe1WAc3GuAAEyOqIsuc852.jpeg" target="_blank" rel="noopener">http://192.168.1.120/group1/M00/00/00/wKgBeFrUe1WAc3GuAAEyOqIsuc852.jpeg</a><br>看到图片显示出来，表示storage已经成功配置nginx服务。<br>如图所示：<br><img src="http://res.cloudinary.com/ini/image/upload/v1523846624/%E9%80%9A%E8%BF%87nginx%E8%AE%BF%E9%97%AEstorage%E6%96%87%E4%BB%B6.jpg" alt=""></p>
<p>完成搭建。</p>
<h5 id="配置第二个group"><a href="#配置第二个group" class="headerlink" title="配置第二个group"></a>配置第二个group</h5><p>新增一台机器，ip为192.168.1.122，按照以上步骤在122机器上安装 libfastcommon, Storage,fastdfs-nginx-module-master,Nginx。</p>
<h6 id="配置Storage"><a href="#配置Storage" class="headerlink" title="配置Storage"></a>配置Storage</h6><p>按照第一台Storage配置文件配置/etc/fdfs/storage.conf<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/fdfs/storage.conf</span><br></pre></td></tr></table></figure></p>
<p>修改group_name为group2<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">group_name=group2</span><br></pre></td></tr></table></figure></p>
<p>然后启动Storage。<br>在120上查看是否已经连接到tracker上。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># fdfs_monitor /etc/fdfs/client.conf | grep ip_addr</span><br><span class="line"></span><br><span class="line">ip_addr = 192.168.1.120  ACTIVE</span><br><span class="line">ip_addr = 192.168.1.121  ACTIVE</span><br><span class="line">ip_addr = 192.168.1.122  ACTIVE</span><br></pre></td></tr></table></figure></p>
<h6 id="配置Nginx"><a href="#配置Nginx" class="headerlink" title="配置Nginx"></a>配置Nginx</h6><p>参照121机器的nginx配置</p>
<h6 id="配置访问120上的Nginx"><a href="#配置访问120上的Nginx" class="headerlink" title="配置访问120上的Nginx"></a>配置访问120上的Nginx</h6><p>如下，添加group2的访问<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">http &#123;</span><br><span class="line">    include       mime.types;</span><br><span class="line">    default_type  application/octet-stream;</span><br><span class="line"></span><br><span class="line">    #log_format  main  &apos;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &apos;</span><br><span class="line">    #                  &apos;$status $body_bytes_sent &quot;$http_referer&quot; &apos;</span><br><span class="line">    #                  &apos;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&apos;;</span><br><span class="line"></span><br><span class="line">    #access_log  logs/access.log  main;</span><br><span class="line"></span><br><span class="line">    sendfile        on;</span><br><span class="line">    #tcp_nopush     on;</span><br><span class="line"></span><br><span class="line">    #keepalive_timeout  0;</span><br><span class="line">    keepalive_timeout  65;</span><br><span class="line"></span><br><span class="line">    #gzip  on;</span><br><span class="line"></span><br><span class="line">    upstream fdfs_group2 &#123;</span><br><span class="line">          server 192.168.1.122 weight=1 max_fails=2 fail_timeout=30s;</span><br><span class="line">    &#125;</span><br><span class="line">    upstream fdfs_group1 &#123;</span><br><span class="line">                server 192.168.1.120:8080 weight=1 max_fails=2 fail_timeout=30s;</span><br><span class="line">                server 192.168.1.121 weight=1 max_fails=2 fail_timeout=30s;</span><br><span class="line">    &#125;</span><br><span class="line">     server &#123;</span><br><span class="line">                listen       80;</span><br><span class="line">                server_name  localhost;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                location /group2/M00 &#123;</span><br><span class="line">                        proxy_next_upstream http_502 http_504 error timeout invalid_header;</span><br><span class="line">                        proxy_pass http://fdfs_group2;</span><br><span class="line">                        expires 30d;</span><br><span class="line">		&#125;</span><br><span class="line">                location /group1/M00 &#123;</span><br><span class="line">                        proxy_next_upstream http_502 http_504 error timeout invalid_header;</span><br><span class="line">                        proxy_pass http://fdfs_group1;</span><br><span class="line">                        expires 30d;</span><br><span class="line">                &#125;</span><br><span class="line">                #其他配置</span><br><span class="line">                 location / &#123;</span><br><span class="line">            		root   html;</span><br><span class="line">            		index  index.html index.htm;</span><br><span class="line">        	&#125;</span><br><span class="line">       &#125;</span><br><span class="line">    server &#123;</span><br><span class="line">        listen       8080;</span><br><span class="line">        server_name  localhost;</span><br><span class="line"></span><br><span class="line">        #charset koi8-r;</span><br><span class="line"></span><br><span class="line">        #access_log  logs/host.access.log  main;</span><br><span class="line"></span><br><span class="line">	location /group1/M00&#123;</span><br><span class="line">	    root /data/fastdfs/storage/data;</span><br><span class="line">	    ngx_fastdfs_module;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">        #error_page  404              /404.html;</span><br><span class="line"></span><br><span class="line">        # redirect server error pages to the static page /50x.html</span><br><span class="line">        #</span><br><span class="line">        error_page   500 502 503 504  /50x.html;</span><br><span class="line">        location = /50x.html &#123;</span><br><span class="line">            root   html;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>通过上传文件测试以及通过nginx访问进行测试。</p>
<p>完成多group配置。</p>
<h5 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h5><p>后来发现有篇博文写的也是很仔细，推荐大家也看一下：</p>
<p><font color="red">分布式文件系统FastDFS实践</font> <a href="https://t.hao0.me/storage/2016/05/10/fastdfs-practice.html" target="_blank" rel="noopener">https://t.hao0.me/storage/2016/05/10/fastdfs-practice.html</a></p>
<h5 id="常见问题"><a href="#常见问题" class="headerlink" title="常见问题"></a>常见问题</h5><h6 id="Storage-WAIT-SYNC-问题"><a href="#Storage-WAIT-SYNC-问题" class="headerlink" title="Storage WAIT_SYNC 问题"></a>Storage WAIT_SYNC 问题</h6><p>正常状态的 Storage 为ACTIVE状态，但有时 Storage 会变为WAIT_SYNC，状态，并且一直不再变化。网上一般是这样处理的，<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#从集群中删除</span><br><span class="line">fdfs_monitor /etc/fdfs/client.conf delete group1 10.120.151.114</span><br><span class="line">#在114服务器中，删除数据文件夹</span><br><span class="line">rm -rf /home/storage1/fastdfs/data</span><br><span class="line">#重启114节点</span><br><span class="line">fdfs_storaged /etc/fdfs/storage.conf</span><br></pre></td></tr></table></figure></p>
<p>但是如果同步的文件很多，这样会耗时，一般只需要从集群中删除，然后在重启被删除的 Storage 即可。</p>
<h5 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h5><p><a href="https://aceld.gitbooks.io/project-d-storage/content/12_fastdfsan_zhuang.html" target="_blank" rel="noopener">https://aceld.gitbooks.io/project-d-storage/content/12_fastdfsan_zhuang.html</a><br><a href="https://blog.csdn.net/pzw_0612/article/details/52610328" target="_blank" rel="noopener">https://blog.csdn.net/pzw_0612/article/details/52610328</a><br><a href="https://t.hao0.me/storage/2016/05/10/fastdfs-practice.html" target="_blank" rel="noopener">https://t.hao0.me/storage/2016/05/10/fastdfs-practice.html</a></p>

        
        </div>


    <!-- 
          <style>
            .linkColor{
                color:#258FC6
            }
            .copyrightFont{
                padding-left:10px;
            }
            .copyrightTitle{
              font-weight:bold;
              font-size:15px;
              display:block;
              padding-left:10px;
              margin-top:5px;
              margin-bottom:5px;
            }
          </style>
          <div style="border: 1px solid black">
            <div>
                <span class='copyrightTitle'>版权声明</span>
                <img src="">
                <br/>
                <p class='copyrightFont'>
                  <a href="http://www.inicb.com" class='linkColor'>Ini&#39;s Blog</a>
                  by
                  <a href="http://www.inicb.com"  class='linkColor'>ini</a>
                  is licensed under a
                  <a href="https://creativecommons.org/licenses/by-nc-nd/4.0/"  class='linkColor'>Creative Commons BY-NC-ND 4.0 International License</a>.
                  <br/>
                  由
                  <a href="http://www.inicb.com"  class='linkColor'>王建磊</a>
                  创作并维护的
                  <a href="http://www.inicb.com"  class='linkColor'>Ini&#39;s Blog</a>
                  采用
                  <a href="https://creativecommons.org/licenses/by-nc-nd/4.0/"  class='linkColor'>创作共用保留署名-非商业-禁止演绎4.0国际许可证</a>。
                  <br/>
                  本文首发于
                  <a href="http://www.inicb.com"  class='linkColor'>Ini&#39;s Blog</a>
                  （ <a href="http://www.inicb.com"  class='linkColor'>http://www.inicb.com</a> ）
                  ，版权所有，侵权必究。
                </p>
            </div>
        </div>
         -->

    

      <div>
        <ul class="post-copyright">
          <li class="post-copyright-author">
          <strong>本文作者：</strong>王建磊</a>
          </li>
          <li class="post-copyright-link">
          <strong>本文链接：</strong>
          <a href="" title="{{ page.title }}">分布式文件系统FastDFS部署搭建</a>
          </li>
          <li class="post-copyright-link">
          <strong>发布时间：</strong>
          <a href="" title="{{ page.title }}">2018年4月11日 - 16时04分</a>
          </li>
          <li class="post-copyright-license">
          <strong>版权声明： </strong>
          本博客所有文章除特别声明外，均采用 <a href="http://creativecommons.org/licenses/by-nc-sa/3.0/cn/" rel="external nofollow" target="_blank">CC BY-NC-SA 3.0 CN</a> 许可协议。转载请注明出处！
          </li>
        </ul>
      <div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://inicb.com/archives/b182ce5c.html" data-id="cjn3vl6yt000fa6oz8om2thtx" class="article-share-link"><i class="fa fa-share"></i>分享到</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    

        </footer>
      
<nav id="article-nav">
    
        <a href="/archives/82fd99c.html" id="article-nav-newer" class="article-nav-link-wrap">
            <strong class="article-nav-caption">上一篇</strong>
            <div class="article-nav-title">
                
                    Nginx配置proxy_pass转发的/路径问题
                
            </div>
        </a>
    
    
        <a href="/archives/a7be2108.html" id="article-nav-older" class="article-nav-link-wrap">
            <strong class="article-nav-caption">下一篇</strong>
            <div class="article-nav-title">CentOs7 修改网卡名字为eth0以及修改静态ip</div>
        </a>
    
</nav>


    
  </div>

    <!-- 
        
<nav id="article-nav">
    
        <a href="/archives/82fd99c.html" id="article-nav-newer" class="article-nav-link-wrap">
            <strong class="article-nav-caption">上一篇</strong>
            <div class="article-nav-title">
                
                    Nginx配置proxy_pass转发的/路径问题
                
            </div>
        </a>
    
    
        <a href="/archives/a7be2108.html" id="article-nav-older" class="article-nav-link-wrap">
            <strong class="article-nav-caption">下一篇</strong>
            <div class="article-nav-title">CentOs7 修改网卡名字为eth0以及修改静态ip</div>
        </a>
    
</nav>


     -->
</article>


    
    
        <section id="comments">
    <div id="valine-thread"></div>

</section>
    



</section>
            
            <!-- 
             -->
        </div>
        <footer id="footer">
    <div class="outer">
        <div id="footer-info" class="inner">
            &copy; 2018 ini<br>
            Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>. Theme by <a href="http://github.com/ppoffice">PPOffice</a>
        </div>
    </div>
</footer>
        
    
    <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
   <script src="//cdn.jsdelivr.net/gh/xcss/valine@v1.1.6/dist/Valine.min.js"></script>

    <script>
        new Valine({
            el: '#valine-thread' ,
            notify:true,
            verify:false,
            app_id: '3RK5nvSxoKincwMiCVLCMFh1-gzGzoHsz',
            app_key: 'MD8jv5EFuHcMxEP2mz5CUbA0',
            placeholder: 'Just Do It'
        });
    </script>





    
        <script src="/libs/lightgallery/js/lightgallery.min.js"></script>
        <script src="/libs/lightgallery/js/lg-thumbnail.min.js"></script>
        <script src="/libs/lightgallery/js/lg-pager.min.js"></script>
        <script src="/libs/lightgallery/js/lg-autoplay.min.js"></script>
        <script src="/libs/lightgallery/js/lg-fullscreen.min.js"></script>
        <script src="/libs/lightgallery/js/lg-zoom.min.js"></script>
        <script src="/libs/lightgallery/js/lg-hash.min.js"></script>
        <script src="/libs/lightgallery/js/lg-share.min.js"></script>
        <script src="/libs/lightgallery/js/lg-video.min.js"></script>
    
    
        <script src="/libs/justified-gallery/jquery.justifiedGallery.min.js"></script>
    
    



<!-- Custom Scripts -->
<script src="/js/main.js"></script>

    </div>
</body>
</html>
