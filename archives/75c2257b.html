<!DOCTYPE html>
<html lang=zh>
<head>
    <meta charset="utf-8">
    
    <title>微信公众号-网页开发 开发入门 | ini&#39;s Blog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="Tips：本文章主要基于微信JS-SDK和jQuery WeUI 进行的微信公众号网页开发。前提需要1.微信公众号已经完成开发者认证。2.在“基本配置”中设置IP白名单。3.提供一个能支持80或者443的服务。  微信官方文档 https://mp.weixin.qq.com/wiki?t=resource/res_main&amp;amp;id=mp1421141115 绑定域名先登录微信公众平台进入">
<meta name="keywords" content="微信公众号">
<meta property="og:type" content="article">
<meta property="og:title" content="微信公众号-网页开发 开发入门">
<meta property="og:url" content="http://inicb.com/archives/75c2257b.html">
<meta property="og:site_name" content="ini&#39;s Blog">
<meta property="og:description" content="Tips：本文章主要基于微信JS-SDK和jQuery WeUI 进行的微信公众号网页开发。前提需要1.微信公众号已经完成开发者认证。2.在“基本配置”中设置IP白名单。3.提供一个能支持80或者443的服务。  微信官方文档 https://mp.weixin.qq.com/wiki?t=resource/res_main&amp;amp;id=mp1421141115 绑定域名先登录微信公众平台进入">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2018-05-14T08:34:18.839Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="微信公众号-网页开发 开发入门">
<meta name="twitter:description" content="Tips：本文章主要基于微信JS-SDK和jQuery WeUI 进行的微信公众号网页开发。前提需要1.微信公众号已经完成开发者认证。2.在“基本配置”中设置IP白名单。3.提供一个能支持80或者443的服务。  微信官方文档 https://mp.weixin.qq.com/wiki?t=resource/res_main&amp;amp;id=mp1421141115 绑定域名先登录微信公众平台进入">
    

    
        <link rel="alternate" href="/" title="ini&#39;s Blog" type="application/atom+xml" />
    

    

    <link rel="stylesheet" href="/libs/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="/libs/open-sans/styles.css">
    <link rel="stylesheet" href="/libs/source-code-pro/styles.css">

    <link rel="stylesheet" href="/css/style.css">

    <script src="/libs/jquery/2.1.3/jquery.min.js"></script>
    
    
        <link rel="stylesheet" href="/libs/lightgallery/css/lightgallery.min.css">
    
    
        <link rel="stylesheet" href="/libs/justified-gallery/justifiedGallery.min.css">
    
    
    
    


</head>

<body>
    <div id="container">
        <header id="header">
    <div id="header-main" class="header-inner">
        <div class="outer">
            <a href="/" id="logo">
                <i class="logo"></i>
                <span class="site-title">ini&#39;s Blog</span>
            </a>
            <nav id="main-nav">
                
                    <a class="main-nav-link" href="/.">Home</a>
                
                    <a class="main-nav-link" href="/archives">Archives</a>
                
                    <a class="main-nav-link" href="/categories">Categories</a>
                
                    <a class="main-nav-link" href="/about">About</a>
                
            </nav>
            
                
                <nav id="sub-nav">
                    <div class="profile" id="profile-nav">
                        <a id="profile-anchor" href="javascript:;">
                            <img class="avatar" src="/css/images/avatar.png" />
                            <i class="fa fa-caret-down"></i>
                        </a>
                    </div>
                </nav>
            
            <div id="search-form-wrap">

    <form class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="搜索" />
        <!-- <button type="submit" class="search-form-submit"></button> -->
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="想要查找什么..." />
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: '文章',
            PAGES: '页面',
            CATEGORIES: '分类',
            TAGS: '标签',
            UNTITLED: '(未命名)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
<script src="/js/insight.js"></script>

</div>

        </div>
    </div>
    <div id="main-nav-mobile" class="header-sub header-inner">
        <table class="menu outer">
            <tr>
                
                    <td><a class="main-nav-link" href="/.">Home</a></td>
                
                    <td><a class="main-nav-link" href="/archives">Archives</a></td>
                
                    <td><a class="main-nav-link" href="/categories">Categories</a></td>
                
                    <td><a class="main-nav-link" href="/about">About</a></td>
                
                <td>
                    
    <div class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="搜索" />
    </div>

                </td>
            </tr>
        </table>
    </div>
</header>

        <div class="outer">
            
            
              <script type='text/javascript'>
              $('body').append("<style type='text/css'>@media screen and (min-width: 1200px) { #main {margin: auto; width: 80%; display: block; float:none;}}</style>");
              </script>
              <script type='text/javascript'>
              document.querySelector('style').textContent += "@media screen and (max-width: 1199px) and (min-width: 800px) { #main {margin: auto; width: 70%; display: block; float:none;}}"
              </script>
           
            <section id="main"><article id="post-微信公众号开发入门" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 class="article-title" itemprop="name">
            微信公众号-网页开发 开发入门
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/archives/75c2257b.html">
            <time datetime="2018-05-11T08:26:11.000Z" itemprop="datePublished">2018-05-11</time>
        </a>
    </div>


                        
    <div class="article-category">
    	<i class="fa fa-folder"></i>
        <a class="article-category-link" href="/categories/技术开发/">技术开发</a><i class="fa fa-angle-right"></i><a class="article-category-link" href="/categories/技术开发/WeChat/">WeChat</a>
    </div>

                        
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/tags/微信公众号/">微信公众号</a>
    </div>

                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <blockquote><p>Tips：<br>本文章主要基于微信JS-SDK和jQuery WeUI 进行的微信公众号网页开发。前提需要<br>1.微信公众号已经完成开发者认证。<br>2.在“基本配置”中设置IP白名单。<br>3.提供一个能支持80或者443的服务。</p>
</blockquote>
<p>微信官方文档 <a href="https://mp.weixin.qq.com/wiki?t=resource/res_main&amp;id=mp1421141115" target="_blank" rel="noopener">https://mp.weixin.qq.com/wiki?t=resource/res_main&amp;id=mp1421141115</a></p>
<h4 id="绑定域名"><a href="#绑定域名" class="headerlink" title="绑定域名"></a>绑定域名</h4><p>先登录微信公众平台进入“公众号设置”的“功能设置”里填写“JS接口安全域名”。</p>
<h4 id="引入JS文件"><a href="#引入JS文件" class="headerlink" title="引入JS文件"></a>引入JS文件</h4><p>在需要调用JS接口的页面引入如下JS文件，（支持https）：<a href="http://res.wx.qq.com/open/js/jweixin-1.2.0.js" target="_blank" rel="noopener">http://res.wx.qq.com/open/js/jweixin-1.2.0.js</a></p>
<h4 id="获取access-token"><a href="#获取access-token" class="headerlink" title="获取access_token"></a>获取access_token</h4><p>access_token 用户获取jsapi_ticket，有效期7200秒，开发者必须在自己的服务全局缓存access_token。<br>建议开发者建立自己的access_token中控服务器统一获取和刷新，其他业务逻辑服务器所使用的access_token均来自于该中控服务器。 <a href="https://mp.weixin.qq.com/wiki?t=resource/res_main&amp;id=mp1421140183" target="_blank" rel="noopener">微信获取access_token接口文档</a></p>
<h6 id="接口调用说明"><a href="#接口调用说明" class="headerlink" title="接口调用说明"></a>接口调用说明</h6><font color="red">前提调用接口时，请登录“微信公众平台-开发-基本配置”提前将服务器IP地址添加到IP白名单中，点击查看设置方法，否则将无法调用成功。</font>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">https请求方式: GET</span><br><span class="line">https://api.weixin.qq.com/cgi-bin/token?grant_type=client_credential&amp;appid=APPID&amp;secret=APPSECRET</span><br></pre></td></tr></table></figure>
<p>我这里使用了shell脚本获取access_token。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a_url=`curl https://api.weixin.qq.com/cgi-bin/token\?grant_type\=client_credential\&amp;appid\=xxx\&amp;secret\=xxxx`</span><br><span class="line">access_token=`echo $a_url|jq -r &apos;.access_token&apos;`</span><br><span class="line">echo $access_token</span><br></pre></td></tr></table></figure></p>
<p>tips: jq 是linux下shell进行json处理的工具，很强大。</p>
<a id="more"></a>
<p>可以使用这个地址测试该接口 <a href="https://mp.weixin.qq.com/debug/cgi-bin/apiinfo?t=index&amp;type=%E5%9F%BA%E7%A1%80%E6%94%AF%E6%8C%81&amp;form=%E8%8E%B7%E5%8F%96access_token%E6%8E%A5%E5%8F%A3%20/token" target="_blank" rel="noopener">使用网页调试工具调试该接口</a></p>
<h4 id="获取jsapi-ticket"><a href="#获取jsapi-ticket" class="headerlink" title="获取jsapi_ticket"></a>获取jsapi_ticket</h4><p>获取jsapi_ticket需要用到上一步的access_token，轻重jsapi_ticket有效期7200秒，开发者必须在自己的服务全局缓存jsapi_ticket。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">https请求方式: GET</span><br><span class="line"># https://api.weixin.qq.com/cgi-bin/ticket/getticket?access_token=ACCESS_TOKEN&amp;type=jsapi</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">&quot;errcode&quot;:0,</span><br><span class="line">&quot;errmsg&quot;:&quot;ok&quot;,</span><br><span class="line">&quot;ticket&quot;:&quot;bxLdikRXVbTPdHSM05e5u5sUoXNKd8-41ZO3MhKoyN5OfkWITDGgnr2fwJ0m9E8NYzWKVZvdVtaUgWvsdshFKA&quot;,</span><br><span class="line">&quot;expires_in&quot;:7200</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>我这里使用了shell脚本来获取，并且保存到文件。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">t_url=`curl https://api.weixin.qq.com/cgi-bin/ticket/getticket\?access_token\=$access_token\&amp;type\=jsapi`</span><br><span class="line">ticket=`echo $t_url | jq -r &apos;.ticket&apos;`</span><br><span class="line">echo $ticket &gt; /opt/tomcat/darenweb_8087/webapps/wx/ticket.txt</span><br></pre></td></tr></table></figure></p>
<p>我这里为了方便使用了crontab定时器每两个小时同步一次access_token和ticket，在生产环境中最好根据expires_in过期时间进行同步。<br>定时脚本如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">00 */2 * * * /bin/bash /server/scripts/get_wx_ticket.sh</span><br></pre></td></tr></table></figure></p>
<p>至此完成了access_token和ticket的获取。</p>
<h4 id="网页开发-通过js-config接口注入权限验证配置"><a href="#网页开发-通过js-config接口注入权限验证配置" class="headerlink" title="网页开发 通过js config接口注入权限验证配置"></a>网页开发 通过js config接口注入权限验证配置</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">wx.config(&#123;</span><br><span class="line">    debug: true, // 开启调试模式,调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印。</span><br><span class="line">    appId: &apos;&apos;, // 必填，公众号的唯一标识</span><br><span class="line">    timestamp: , // 必填，生成签名的时间戳</span><br><span class="line">    nonceStr: &apos;&apos;, // 必填，生成签名的随机串</span><br><span class="line">    signature: &apos;&apos;,// 必填，签名</span><br><span class="line">    jsApiList: [] // 必填，需要使用的JS接口列表</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>所有需要使用JS-SDK的页面必须先注入配置信息，否则将无法调用。<br>在config之前需要对config所需参数进行签名，获取config方法网页端如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line">function getWxTicket()&#123;</span><br><span class="line">        $.ajax(&#123;</span><br><span class="line">            // url: &quot;http://localhost:8080/aa/sign?originUrl=http://localhost:8080/login.html&quot;,</span><br><span class="line">            url: &quot;http://xxxx/sign?originUrl=&quot;+window.location.href,</span><br><span class="line">            type: &quot;GET&quot;,</span><br><span class="line">            dataType: &apos;json&apos;,</span><br><span class="line">//            crossDomain: true,</span><br><span class="line">//            jsonp: &quot;callback&quot;,//传递给请求处理程序或页面的，用以获得jsonp回调函数名的参数名(一般默认为:callback)</span><br><span class="line">//            jsonpCallback:&quot;flightHandler&quot;,//自定义的jsonp回调函数名称，默认为jQuery自动生成的随机函数名，也可以写&quot;?&quot;，jQuery会自动为你处理数据</span><br><span class="line">            success: function (response) &#123;</span><br><span class="line">                // alert(&quot;11111111&quot;);</span><br><span class="line">                wxConfig = response;</span><br><span class="line"></span><br><span class="line">                if (isDebug)&#123;</span><br><span class="line">                    // window.access_token = response.access_token;</span><br><span class="line">                    alert(wxConfig.timestamp);</span><br><span class="line">                    alert(wxConfig.nonce);</span><br><span class="line">                    alert(wxConfig.jsapi_ticket);</span><br><span class="line">                &#125;</span><br><span class="line">                Wx_config();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    function Wx_config() &#123;</span><br><span class="line"></span><br><span class="line">        wx.ready(function () &#123;</span><br><span class="line">            // config信息验证后会执行ready方法，所有接口调用都必须在config接口获得结果之后，config是一个客户端的异步操作，所以如果需要在页面加载时就调用相关接口，则须把相关接口放在ready函数中调用来确保正确执行。对于用户触发时才调用的接口，则可以直接调用，不需要放在ready函数中。</span><br><span class="line">            if (isDebug) &#123;</span><br><span class="line">                alert(&quot;ready&quot;);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            //在微信网页端 隐藏不需要的功能按钮</span><br><span class="line">            wx.hideMenuItems(&#123;</span><br><span class="line">                menuList: [&apos;menuItem:share:appMessage&apos;,</span><br><span class="line">                    &apos;menuItem:share:timeline&apos;,</span><br><span class="line">                    &apos;menuItem:share:qq&apos;,</span><br><span class="line">                    &apos;menuItem:share:weiboApp&apos;,</span><br><span class="line">                    &apos;menuItem:share:facebook&apos;,</span><br><span class="line">                    &apos;menuItem:share:QZone&apos;,</span><br><span class="line">                    &apos;menuItem:editTag&apos;,</span><br><span class="line">                    &apos;menuItem:delete&apos;,</span><br><span class="line">                    &apos;menuItem:copyUrl&apos;,</span><br><span class="line">                    &apos;menuItem:originPage&apos;,</span><br><span class="line">                    &apos;menuItem:openWithQQBrowser&apos;,</span><br><span class="line">                    &apos;menuItem:openWithSafari&apos;,</span><br><span class="line">                    &apos;menuItem:share:email&apos;,</span><br><span class="line">                    &apos;menuItem:favorite&apos;], // 要隐藏的菜单项，只能隐藏“传播类”和“保护类”按钮，所有menu项见附录3</span><br><span class="line">                success: function (res) &#123;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">        /*</span><br><span class="line">    * 注意：</span><br><span class="line">    * 1. 所有的JS接口只能在公众号绑定的域名下调用，公众号开发者需要先登录微信公众平台进入“公众号设置”的“功能设置”里填写“JS接口安全域名”。</span><br><span class="line">    * 2. 如果发现在 Android 不能分享自定义内容，请到官网下载最新的包覆盖安装，Android 自定义分享接口需升级至 6.0.2.58 版本及以上。</span><br><span class="line">    * 3. 完整 JS-SDK 文档地址：http://mp.weixin.qq.com/wiki/7/aaa137b55fb2e0456bf8dd9148dd613f.html</span><br><span class="line">    */</span><br><span class="line">        wx.error(function (res) &#123;</span><br><span class="line">            if (isDebug) &#123;</span><br><span class="line"></span><br><span class="line">                alert(&quot;error&quot;);</span><br><span class="line">                alert(res);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        wx.config(&#123;</span><br><span class="line">            debug: false, // 开启调试模式,调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印。</span><br><span class="line">            appId: &apos;wx040138c462be4cb0&apos;, // 必填，公众号的唯一标识</span><br><span class="line">            timestamp: wxConfig.timestamp, // 必填，生成签名的时间戳</span><br><span class="line">            nonceStr: wxConfig.nonce, // 必填，生成签名的随机串</span><br><span class="line">            signature: wxConfig.signature,// 必填，签名</span><br><span class="line">            jsApiList: [</span><br><span class="line">                &apos;hideMenuItems&apos;,</span><br><span class="line">                &apos;showMenuItems&apos;,</span><br><span class="line">                &apos;hideAllNonBaseMenuItem&apos;,</span><br><span class="line">                &apos;showAllNonBaseMenuItem&apos;,</span><br><span class="line">                &apos;chooseImage&apos;,</span><br><span class="line">                &apos;previewImage&apos;,</span><br><span class="line">                &apos;uploadImage&apos;,</span><br><span class="line">                &apos;downloadImage&apos;,</span><br><span class="line">                &apos;getNetworkType&apos;,</span><br><span class="line">                &apos;openLocation&apos;,</span><br><span class="line">                &apos;getLocation&apos;,</span><br><span class="line">                &apos;hideOptionMenu&apos;,</span><br><span class="line">                &apos;showOptionMenu&apos;,</span><br><span class="line">                &apos;closeWindow&apos;,</span><br><span class="line">                &apos;scanQRCode&apos;,</span><br><span class="line">                &apos;chooseWXPay&apos;,</span><br><span class="line">                &apos;openProductSpecificView&apos;,</span><br><span class="line">                &apos;addCard&apos;,</span><br><span class="line">                &apos;chooseCard&apos;,</span><br><span class="line">                &apos;openCard&apos;] // 必填，需要使用的JS接口列表</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p>后台进行签名，签名算法如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">    *</span><br><span class="line">    * @param originUrl 需要加密的URL</span><br><span class="line">    * @param request</span><br><span class="line">    * @param response</span><br><span class="line">    * @return</span><br><span class="line">    */</span><br><span class="line">   @SuppressWarnings(&#123; &quot;unchecked&quot;, &quot;rawtypes&quot;, &quot;null&quot; &#125;)</span><br><span class="line">   @RequestMapping(value = &quot;/sign&quot;, method = RequestMethod.GET)</span><br><span class="line">   @ResponseBody</span><br><span class="line">   public HashMap getSignature(String originUrl , HttpServletRequest request, HttpServletResponse response) &#123;</span><br><span class="line"></span><br><span class="line">       File file = new File(&quot;/opt/tomcat/darenweb_8087/webapps/wx/ticket.txt&quot;);</span><br><span class="line">       StringBuilder ticket = new StringBuilder();</span><br><span class="line">       BufferedReader reader = null;</span><br><span class="line">       try &#123;</span><br><span class="line">           reader = new BufferedReader(new FileReader(file));</span><br><span class="line">           String tempString = null;</span><br><span class="line">           int line = 1;</span><br><span class="line">           // 一次读入一行，直到读入null为文件结束</span><br><span class="line">           while ((tempString = reader.readLine()) != null) &#123;</span><br><span class="line">               // 显示行号</span><br><span class="line">               ticket.append(tempString);</span><br><span class="line">           &#125;</span><br><span class="line">           reader.close();</span><br><span class="line"></span><br><span class="line">       &#125; catch (Exception e) &#123;</span><br><span class="line">           e.printStackTrace();</span><br><span class="line">       &#125;</span><br><span class="line">       //2、获取Ticket</span><br><span class="line">       String jsapi_ticket = ticket.toString();</span><br><span class="line">       //3、时间戳和随机字符串</span><br><span class="line">       String noncestr = UUID.randomUUID().toString().replace(&quot;-&quot;, &quot;&quot;).substring(0, 16);//随机字符串</span><br><span class="line">       String timestamp = String.valueOf(System.currentTimeMillis() / 1000);//时间戳</span><br><span class="line"></span><br><span class="line">       //4、获取url</span><br><span class="line">       String url= originUrl;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">       String  string1 = &quot;jsapi_ticket=&quot; + jsapi_ticket + &quot;&amp;noncestr=&quot; + noncestr</span><br><span class="line">               + &quot;&amp;timestamp=&quot; + timestamp  + &quot;&amp;url=&quot; + url;</span><br><span class="line">       MessageDigest crypt = null;</span><br><span class="line">       try &#123;</span><br><span class="line">           crypt = MessageDigest.getInstance(&quot;SHA-1&quot;);</span><br><span class="line"></span><br><span class="line">           crypt.reset();</span><br><span class="line">           crypt.update(string1.getBytes(&quot;UTF-8&quot;));</span><br><span class="line">       &#125; catch (UnsupportedEncodingException e) &#123;</span><br><span class="line">           e.printStackTrace();</span><br><span class="line">       &#125; catch (NoSuchAlgorithmException e) &#123;</span><br><span class="line">           e.printStackTrace();</span><br><span class="line">       &#125;</span><br><span class="line">       String signature = byteToHex(crypt.digest());</span><br><span class="line"></span><br><span class="line">       HashMap&lt;String,String&gt; map = new HashMap&lt;&gt;();</span><br><span class="line">       map.put(&quot;signature&quot;,signature);</span><br><span class="line">       map.put(&quot;timestamp&quot;,timestamp);</span><br><span class="line">       map.put(&quot;jsapi_ticket&quot;,jsapi_ticket);</span><br><span class="line">       map.put(&quot;nonce&quot;,noncestr);</span><br><span class="line">       return  map;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></p>
<p>至此完成了微信号网页开发的配置和授权。</p>
<h4 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h4><ul>
<li><a href="http://jqweui.com/" target="_blank" rel="noopener">jQuery WeUI 官方</a></li>
<li><a href="https://mp.weixin.qq.com/wiki?t=resource/res_main&amp;id=mp1421141115" target="_blank" rel="noopener">微信公众号官方</a></li>
</ul>

        
        </div>


    <!-- 
          <style>
            .linkColor{
                color:#258FC6
            }
            .copyrightFont{
                padding-left:10px;
            }
            .copyrightTitle{
              font-weight:bold;
              font-size:15px;
              display:block;
              padding-left:10px;
              margin-top:5px;
              margin-bottom:5px;
            }
          </style>
          <div style="border: 1px solid black">
            <div>
                <span class='copyrightTitle'>版权声明</span>
                <img src="">
                <br/>
                <p class='copyrightFont'>
                  <a href="http://www.inicb.com" class='linkColor'>Ini&#39;s Blog</a>
                  by
                  <a href="http://www.inicb.com"  class='linkColor'>ini</a>
                  is licensed under a
                  <a href="https://creativecommons.org/licenses/by-nc-nd/4.0/"  class='linkColor'>Creative Commons BY-NC-ND 4.0 International License</a>.
                  <br/>
                  由
                  <a href="http://www.inicb.com"  class='linkColor'>王建磊</a>
                  创作并维护的
                  <a href="http://www.inicb.com"  class='linkColor'>Ini&#39;s Blog</a>
                  采用
                  <a href="https://creativecommons.org/licenses/by-nc-nd/4.0/"  class='linkColor'>创作共用保留署名-非商业-禁止演绎4.0国际许可证</a>。
                  <br/>
                  本文首发于
                  <a href="http://www.inicb.com"  class='linkColor'>Ini&#39;s Blog</a>
                  （ <a href="http://www.inicb.com"  class='linkColor'>http://www.inicb.com</a> ）
                  ，版权所有，侵权必究。
                </p>
            </div>
        </div>
         -->

    

      <div>
        <ul class="post-copyright">
          <li class="post-copyright-author">
          <strong>本文作者：</strong>王建磊</a>
          </li>
          <li class="post-copyright-link">
          <strong>本文链接：</strong>
          <a href="" title="{{ page.title }}">微信公众号-网页开发 开发入门</a>
          </li>
          <li class="post-copyright-link">
          <strong>发布时间：</strong>
          <a href="" title="{{ page.title }}">2018年5月11日 - 16时05分</a>
          </li>
          <li class="post-copyright-license">
          <strong>版权声明： </strong>
          本博客所有文章除特别声明外，均采用 <a href="http://creativecommons.org/licenses/by-nc-sa/3.0/cn/" rel="external nofollow" target="_blank">CC BY-NC-SA 3.0 CN</a> 许可协议。转载请注明出处！
          </li>
        </ul>
      <div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://inicb.com/archives/75c2257b.html" data-id="cjtrwgf18001929ozr4peh9ee" class="article-share-link"><i class="fa fa-share"></i>分享到</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    

        </footer>
      
<nav id="article-nav">
    
        <a href="/archives/f38a06d2.html" id="article-nav-newer" class="article-nav-link-wrap">
            <strong class="article-nav-caption">上一篇</strong>
            <div class="article-nav-title">
                
                    使用Burp和sqlmap进行自动化sql注入
                
            </div>
        </a>
    
    
        <a href="/archives/c4bd228f.html" id="article-nav-older" class="article-nav-link-wrap">
            <strong class="article-nav-caption">下一篇</strong>
            <div class="article-nav-title">Mac 使用Burp Suite进行手机端代理抓包</div>
        </a>
    
</nav>


    
  </div>

    <!-- 
        
<nav id="article-nav">
    
        <a href="/archives/f38a06d2.html" id="article-nav-newer" class="article-nav-link-wrap">
            <strong class="article-nav-caption">上一篇</strong>
            <div class="article-nav-title">
                
                    使用Burp和sqlmap进行自动化sql注入
                
            </div>
        </a>
    
    
        <a href="/archives/c4bd228f.html" id="article-nav-older" class="article-nav-link-wrap">
            <strong class="article-nav-caption">下一篇</strong>
            <div class="article-nav-title">Mac 使用Burp Suite进行手机端代理抓包</div>
        </a>
    
</nav>


     -->
</article>


    
    
        <section id="comments">
    <div id="valine-thread"></div>

</section>
    



</section>
            
            <!-- 
             -->
        </div>
        <footer id="footer">
    <div class="outer">
        <div id="footer-info" class="inner">
            &copy; 2019 ini<br>
            Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>. Theme by <a href="http://github.com/ppoffice">PPOffice</a>
        </div>
    </div>
</footer>
        
    
    <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
   <script src="//cdn.jsdelivr.net/gh/xcss/valine@v1.1.6/dist/Valine.min.js"></script>

    <script>
        new Valine({
            el: '#valine-thread' ,
            notify:true,
            verify:false,
            app_id: '3RK5nvSxoKincwMiCVLCMFh1-gzGzoHsz',
            app_key: 'MD8jv5EFuHcMxEP2mz5CUbA0',
            placeholder: 'Just Do It'
        });
    </script>





    
        <script src="/libs/lightgallery/js/lightgallery.min.js"></script>
        <script src="/libs/lightgallery/js/lg-thumbnail.min.js"></script>
        <script src="/libs/lightgallery/js/lg-pager.min.js"></script>
        <script src="/libs/lightgallery/js/lg-autoplay.min.js"></script>
        <script src="/libs/lightgallery/js/lg-fullscreen.min.js"></script>
        <script src="/libs/lightgallery/js/lg-zoom.min.js"></script>
        <script src="/libs/lightgallery/js/lg-hash.min.js"></script>
        <script src="/libs/lightgallery/js/lg-share.min.js"></script>
        <script src="/libs/lightgallery/js/lg-video.min.js"></script>
    
    
        <script src="/libs/justified-gallery/jquery.justifiedGallery.min.js"></script>
    
    



<!-- Custom Scripts -->
<script src="/js/main.js"></script>

    </div>
</body>
</html>
